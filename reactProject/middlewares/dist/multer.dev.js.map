{"version":3,"sources":["multer.js"],"names":["multer","require","fs","AppError","existsSync","mkdirSync","storage","diskStorage","destination","req","file","cb","filename","Date","toISOString","replace","originalname","multerFilter","mimetype","startsWith","upload","fileFilter","module","exports"],"mappings":";;AAAA,IAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;AACA,IAAME,QAAQ,GAAGF,OAAO,CAAC,mBAAD,CAAxB;;AAEA,IAAI,CAACC,EAAE,CAACE,UAAH,CAAc,SAAd,CAAL,EAA+B;AAC7BF,EAAAA,EAAE,CAACG,SAAH,CAAa,SAAb;AACD;;AACD,IAAMC,OAAO,GAAGN,MAAM,CAACO,WAAP,CAAmB;AACjCC,EAAAA,WAAW,EAAE,qBAAUC,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AACpCA,IAAAA,EAAE,CAAC,IAAD,EAAO,SAAP,CAAF;AACD,GAHgC;AAIjCC,EAAAA,QAAQ,EAAE,kBAAUH,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AACjCA,IAAAA,EAAE,CAAC,IAAD,EAAO,IAAIE,IAAJ,GAAWC,WAAX,GAAyBC,OAAzB,CAAiC,IAAjC,EAAuC,GAAvC,IAA8CL,IAAI,CAACM,YAA1D,CAAF;AACD;AANgC,CAAnB,CAAhB;;AASA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACR,GAAD,EAAMC,IAAN,EAAYC,EAAZ,EAAmB;AACtC,MAAID,IAAI,CAACQ,QAAL,CAAcC,UAAd,CAAyB,QAAzB,CAAJ,EAAwC;AACtCR,IAAAA,EAAE,CAAC,IAAD,EAAO,IAAP,CAAF;AACD,GAFD,MAEO;AACLA,IAAAA,EAAE,CACA,IAAIR,QAAJ,CAAa,iDAAb,EAAgE,GAAhE,CADA,EAEA,KAFA,CAAF;AAID;AACF,CATD;;AAWA,IAAMiB,MAAM,GAAGpB,MAAM,CAAC;AACpBM,EAAAA,OAAO,EAAEA,OADW;AAEpBe,EAAAA,UAAU,EAAEJ;AAFQ,CAAD,CAArB;AAKAK,MAAM,CAACC,OAAP,GAAiBH,MAAjB","sourcesContent":["const multer = require('multer');\r\nconst fs = require('fs');\r\nconst AppError = require('../utils/appError');\r\n\r\nif (!fs.existsSync('./media')) {\r\n  fs.mkdirSync('./media');\r\n}\r\nconst storage = multer.diskStorage({\r\n  destination: function (req, file, cb) {\r\n    cb(null, './media');\r\n  },\r\n  filename: function (req, file, cb) {\r\n    cb(null, new Date().toISOString().replace(/:/g, '.') + file.originalname);\r\n  },\r\n});\r\n\r\nconst multerFilter = (req, file, cb) => {\r\n  if (file.mimetype.startsWith('image/')) {\r\n    cb(null, true);\r\n  } else {\r\n    cb(\r\n      new AppError('File type not supported. Only image is allowed.', 401),\r\n      false\r\n    );\r\n  }\r\n};\r\n\r\nconst upload = multer({\r\n  storage: storage,\r\n  fileFilter: multerFilter,\r\n});\r\n\r\nmodule.exports = upload;\r\n"],"file":"multer.dev.js"}