{"version":3,"sources":["authController.js"],"names":["require","promisify","jwt","expressHandler","userValidation","uploadMedia","config","exports","signup","req","res","next","_userValidation$newUs","error","value","newUser","regeneratorRuntime","async","_context","prev","createToken","email","body","passwordConfirm","abrupt","AppError","details","message","awrap","User","findOne","sent","create","name","password","stop","login","_req$body","user","_context2","t0","existingUser","edit","uploadRes","_context3","console","log","params","id","file","path","secure_url","findByIdAndUpdate","media","status","json","state","token","decoded","_context4","headers","authorization","startsWith","split","cookies","verify","process","env","JWT_SECRET"],"mappings":"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","file":"authController.min.js","sourcesContent":["const { promisify } = require('util');\r\nconst jwt = require('jsonwebtoken');\r\nconst expressHandler = require('express-async-handler');\r\nconst User = require('../models/userModel');\r\nconst userValidation = require('../utils/validation/userValidation');\r\nconst createToken = require('../utils/createToken');\r\nconst uploadMedia = require('../utils/uploadMedia');\r\nconst AppError = require('../utils/appError');\r\nrequire('dotenv').config();\r\nexports.signup = expressHandler(async (req, res, next) => {\r\n  // const uploadRes = await uploadMedia(req.file.path);\r\n\r\n  const { error, value } = userValidation.newUser({\r\n    name: req.body.name,\r\n    email: req.body.email,\r\n    password: req.body.password,\r\n    passwordConfirm: req.body.passwordConfirm,\r\n    // media: uploadRes.secure_url,\r\n  });\r\n  if (error) {\r\n    return next(new AppError(error.details[0].message, 400));\r\n  }\r\n\r\n  const existingUser = await User.findOne({ email: value.email });\r\n  if (existingUser) {\r\n    return next(new AppError('Email already exists', 400));\r\n  }\r\n\r\n  const newUser = await User.create({\r\n    name: req.body.name,\r\n    email: req.body.email,\r\n    password: req.body.password,\r\n    passwordConfirm: req.body.passwordConfirm,\r\n    // media: uploadRes.secure_url,\r\n  });\r\n\r\n  createToken(newUser, 201, req, res);\r\n});\r\n\r\nexports.login = expressHandler(async (req, res, next) => {\r\n  const { email, password } = req.body;\r\n  if (!email || !password) {\r\n    return next(new AppError('Email And Password Are Required', 400));\r\n  }\r\n\r\n  const user = await User.findOne({ email: email });\r\n\r\n  if (!user || !(await user.correctPassword(password, user.password))) {\r\n    return next(new AppError('Incorrect Email Or Password', 400));\r\n  }\r\n\r\n  createToken(user, 200, req, res);\r\n});\r\n\r\nexports.edit = expressHandler(async (req, res, next) => {\r\n  console.log(req.params.id);\r\n\r\n  const uploadRes = await uploadMedia(req.file.path);\r\n  console.log('upload ', uploadRes.secure_url);\r\n  const user = await User.findByIdAndUpdate(\r\n    req.params.id,\r\n    {\r\n      media: uploadRes.secure_url,\r\n    },\r\n    {\r\n      new: true,\r\n    }\r\n  );\r\n  console.log(user);\r\n  res.status(201).json({\r\n    state: 'success',\r\n    data: user,\r\n  });\r\n});\r\n\r\nexports.protected = expressHandler(async (req, res, next) => {\r\n  let token;\r\n  if (\r\n    req.headers.authorization &&\r\n    req.headers.authorization.startsWith('Bearer')\r\n  ) {\r\n    token = req.headers.authorization.split(' ')[1];\r\n  } else if (req.cookies.jwt) {\r\n    token = req.cookies.jwt;\r\n  }\r\n\r\n  if (!token) {\r\n    return next(\r\n      new AppError('You Are Not Logged In! Please Log In To Get Access.', 401)\r\n    );\r\n  }\r\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n  req.user = decoded;\r\n  next();\r\n});\r\n"]}