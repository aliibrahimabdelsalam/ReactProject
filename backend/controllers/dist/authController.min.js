"use strict";var _require=require("util"),promisify=_require.promisify,jwt=require("jsonwebtoken"),expressHandler=require("express-async-handler"),User=require("../models/userModel"),userValidation=require("../utils/validation/userValidation"),createToken=require("../utils/createToken"),uploadMedia=require("../utils/uploadMedia"),AppError=require("../utils/appError");require("dotenv").config(),exports.signup=expressHandler(function(r,a,n){var t,s,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=userValidation.newUser({name:r.body.name,email:r.body.email,password:r.body.password,passwordConfirm:r.body.passwordConfirm}),s=t.error,o=t.value,s)return e.abrupt("return",n(new AppError(s.details[0].message,400)));e.next=3;break;case 3:return e.next=5,regeneratorRuntime.awrap(User.findOne({email:o.email}));case 5:if(e.sent)return e.abrupt("return",n(new AppError("Email already exists",400)));e.next=8;break;case 8:return e.next=10,regeneratorRuntime.awrap(User.create({name:r.body.name,email:r.body.email,password:r.body.password,passwordConfirm:r.body.passwordConfirm}));case 10:i=e.sent,createToken(i,201,r,a);case 12:case"end":return e.stop()}})}),exports.login=expressHandler(function(r,a,n){var t,s,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.body,s=t.email,o=t.password,s&&o){e.next=3;break}return e.abrupt("return",n(new AppError("Email And Password Are Required",400)));case 3:return e.next=5,regeneratorRuntime.awrap(User.findOne({email:s}));case 5:if(i=e.sent,e.t0=!i,e.t0){e.next=11;break}return e.next=10,regeneratorRuntime.awrap(i.correctPassword(o,i.password));case 10:e.t0=!e.sent;case 11:if(e.t0)return e.abrupt("return",n(new AppError("Incorrect Email Or Password",400)));e.next=13;break;case 13:createToken(i,200,r,a);case 14:case"end":return e.stop()}})}),exports.edit=expressHandler(function(r,a){var n,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r.params.id),e.next=3,regeneratorRuntime.awrap(uploadMedia(r.file.path));case 3:return n=e.sent,console.log("upload ",n.secure_url),e.next=7,regeneratorRuntime.awrap(User.findByIdAndUpdate(r.params.id,{media:n.secure_url},{new:!0}));case 7:t=e.sent,console.log(t),a.status(201).json({state:"success",data:t});case 10:case"end":return e.stop()}})}),exports.protected=expressHandler(function(r,e,a){var n,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.headers.authorization&&r.headers.authorization.startsWith("Bearer")?n=r.headers.authorization.split(" ")[1]:r.cookies.jwt&&(n=r.cookies.jwt),n){e.next=3;break}return e.abrupt("return",a(new AppError("You Are Not Logged In! Please Log In To Get Access.",401)));case 3:t=jwt.verify(n,process.env.JWT_SECRET),r.user=t,a();case 6:case"end":return e.stop()}})});
//# sourceMappingURL=authController.min.js.map
